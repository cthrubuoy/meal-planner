<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meal Planner & Shopping List ‚Äî v9</title>

  <link rel="stylesheet" href="assets/styles.css" />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b0f1a">

  <!-- iOS home screen icon support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Meal Planner">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">

  <script defer src="assets/app.js"></script>
  <script defer src="assets/pwa.js"></script>
</head>

<body>
  <header>
    <div class="wrap headerbar">
      <h1>üõí Meal Planner & Shopping List <span class="pill">v9</span></h1>
      <div class="group">
        <button class="btn" id="theme-toggle" title="Toggle theme">üåô</button>
        <button class="btn" id="settings">Settings</button>
      </div>
    </div>
  </header>

  <main class="layout">
    <!-- LEFT: Add -->
    <section class="panel" id="add-panel">
      <div class="inner">
        <h2 class="collapsible-header" id="add-header">Add a meal <span class="chev">‚ñæ</span></h2>

        <div class="collapsible-body" id="add-body">
          <form id="meal-form">
            <div class="form-row">
              <label for="title">Meal name</label>
              <input id="title" type="text" placeholder="e.g. Chicken fajitas" required maxlength="80" />
            </div>

            <div class="form-row">
              <label for="image-file">Photo (upload)</label>
              <input id="image-file" type="file" accept="image/*" />
              <small class="muted">Images are compressed; if upload fails, the meal will still save without a photo.</small>
            </div>

            <div class="form-row">
              <label for="cook-mins">Time to cook (mins)</label>
              <input id="cook-mins" type="number" min="0" max="120" step="5" placeholder="e.g. 30" />
            </div>

            <div class="form-row">
              <div class="group space-between">
                <label>Ingredients</label>
                <small class="muted">Tap ‚Äú+ Add ingredient‚Äù to jump to the new row</small>
              </div>
              <div id="ingredients" class="ingredients" aria-live="polite"></div>
              <div class="group">
                <button class="btn primary big-action" type="button" id="add-ingredient">+ Add ingredient</button>
                <button class="btn" type="button" id="duplicate-last" title="Duplicate last meal">Duplicate last</button>
              </div>
            </div>

            <div class="form-row">
              <label>Tags (auto-seeded from ingredients; comma or Enter to add)</label>
              <div class="group" id="tags-editor"></div>
              <input id="tags-input" type="text" list="tag-suggestions" placeholder="e.g. veggie, quick" />
            </div>

            <div class="form-row">
              <label>Steps</label>
              <div class="group">
                <input id="step-input" type="text" placeholder="Add a step (e.g. Fry onions for 5 mins)" />
                <button class="btn primary big-action" type="button" id="add-step">+ Add step</button>
              </div>
              <div id="steps" class="steps"></div>
              <small class="muted">Use ‚Üë ‚Üì to reorder.</small>
            </div>

            <div class="form-row">
              <label for="notes">Notes</label>
              <textarea id="notes" rows="4" placeholder="Optional notes (e.g. less chilli for kids, freezes well)"></textarea>
            </div>

            <div class="form-row">
              <div class="group">
                <button class="btn primary big-action" type="submit">Add meal</button>
                <button class="btn" type="reset" id="reset-form">Reset</button>
              </div>
            </div>

            <hr class="sep" />

            <div class="toolbar">
              <div class="group">
                <button class="btn" id="export">Export</button>
                <label class="btn" for="import">Import</label>
                <input id="import" type="file" accept="application/json" style="display:none" />
                <button class="btn danger" id="clear-all">Clear all</button>
              </div>
              <span class="muted" id="status"></span>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- RIGHT: Views (mobile switches between these) -->
    <section class="panel" id="right-panel">
      <div class="inner">
        <!-- View: Meals -->
        <section id="view-meals" class="view">
          <div class="toolbar">
            <h2 class="h2">Your meals</h2>

            <div class="group desktop-controls">
              <input id="search" type="text" placeholder="Search titles‚Ä¶" style="width:220px" />

              <div class="group" title="Filter by time">
                <span class="muted">‚è±</span>
                <div class="range">
                  <input id="time-min" type="range" min="0" max="120" step="5" value="0" />
                  <span class="muted" id="time-label">0‚Äì120 min</span>
                  <input id="time-max" type="range" min="0" max="120" step="5" value="120" />
                  <button class="btn" id="time-clear" title="Clear time filter">Clear</button>
                </div>
              </div>

              <button class="btn" id="toggle-favs">Show favourites only</button>

              <label class="muted">Grid</label>
              <button class="btn" data-density="compact">Compact</button>
              <button class="btn" data-density="cozy">Cozy</button>
              <button class="btn" data-density="comfy">Comfy</button>
            </div>

            <div class="group mobile-controls">
              <input id="search-m" type="text" placeholder="Search‚Ä¶" style="width:min(56vw,260px)" />
              <button class="btn primary big-action" id="open-filters">Filters</button>
            </div>
          </div>

          <div class="toolbar tight">
            <div class="tagbar" id="tag-bar" title="Scroll to see more tags"></div>
            <div class="group">
              <button class="btn" id="tag-filter">Filter by tag ‚ñæ</button>
              <span class="muted" id="tag-active"></span>
            </div>
          </div>

          <div id="meal-grid" class="grid" aria-live="polite"></div>
        </section>

        <!-- View: Shopping -->
        <section id="view-shopping" class="view">
          <div class="toolbar">
            <h2 class="h2">Shopping list</h2>
            <div class="group">
              <button class="btn" id="copy-tsv" title="Copy as tab-separated for Excel">Copy as TSV</button>
              <button class="btn" id="print">Print</button>
            </div>
          </div>

          <div class="toolbar tight">
            <span class="muted">Tick meals to include</span>
            <span class="muted" id="selected-count"></span>
          </div>

          <div id="shopping"></div>
        </section>

        <!-- View: Cook (single meal) -->
        <section id="view-cook" class="view">
          <div class="toolbar">
            <h2 class="h2">Cook mode</h2>
            <span class="muted">Choose one meal and work through the steps</span>
          </div>

          <div class="form-row">
            <label for="cook-meal">Meal</label>
            <select id="cook-meal"></select>
          </div>

          <div id="cook-meta" class="cook-meta"></div>
          <div id="cook-steps" class="cook-steps"></div>
        </section>
      </div>
    </section>
  </main>

  <datalist id="ingredient-suggestions"></datalist>
  <datalist id="tag-suggestions"></datalist>

  <template id="ingredient-template">
    <div class="ingredient-row">
      <input type="text" placeholder="Ingredient (e.g. chicken breast)" list="ingredient-suggestions" required maxlength="80" />
      <select>
        <option value="grams">grams</option>
        <option value="ml">ml</option>
        <option value="tsp">tsp</option>
        <option value="tbsp">tbsp</option>
        <option value="cup">cup</option>
        <option value="qty">quantity</option>
      </select>
      <input type="number" min="0" step="any" placeholder="Amount" required />
      <input type="text" placeholder="Unit label (optional, e.g. pack, tin)" maxlength="24" />
      <button type="button" class="remove" title="Remove">√ó</button>
    </div>
  </template>

  <!-- Edit modal -->
  <div id="edit-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="dialog">
      <div class="toolbar stickybar">
        <h3 class="h3">Edit meal</h3>
        <button class="btn" id="edit-close">Close</button>
      </div>

      <form id="edit-form">
        <div class="form-row">
          <label for="edit-title">Meal name</label>
          <input id="edit-title" type="text" required maxlength="80" />
        </div>

        <div class="form-row">
          <label for="edit-image-file">Replace photo (upload)</label>
          <input id="edit-image-file" type="file" accept="image/*" />
        </div>

        <div class="form-row">
          <label for="edit-cook-mins">Time to cook (mins)</label>
          <input id="edit-cook-mins" type="number" min="0" max="120" step="5" />
        </div>

        <div class="form-row">
          <label>Ingredients</label>
          <div id="edit-ingredients" class="ingredients"></div>
          <button class="btn primary big-action" type="button" id="edit-add-ingredient">+ Add ingredient</button>
        </div>

        <div class="form-row">
          <label>Tags</label>
          <div class="group" id="edit-tags-editor"></div>
          <div class="group">
            <input id="edit-tags-input" type="text" list="tag-suggestions" placeholder="Add a tag" />
            <button class="btn" id="edit-tags-from-ingredients" type="button">Add ingredient names as tags</button>
          </div>
        </div>

        <div class="form-row">
          <label>Steps</label>
          <div class="group">
            <input id="edit-step-input" type="text" placeholder="Add a step" />
            <button class="btn primary big-action" type="button" id="edit-add-step">+ Add step</button>
          </div>
          <div id="edit-steps" class="steps"></div>
        </div>

        <div class="form-row">
          <label for="edit-notes">Notes</label>
          <textarea id="edit-notes" rows="4"></textarea>
        </div>

        <div class="form-row">
          <button class="btn primary big-action" type="submit">Save changes</button>
          <button class="btn" type="button" id="edit-cancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Settings modal -->
  <div id="settings-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="dialog">
      <div class="toolbar stickybar">
        <h3 class="h3">Settings</h3>
        <div class="group">
          <button class="btn" id="backfill-tags" title="Merge ingredient names into meal tags">Backfill tags</button>
          <button class="btn" id="settings-close">Close</button>
        </div>
      </div>

      <div class="row">
        <section>
          <h4 class="h4">Ingredient normaliser</h4>
          <table class="table" id="norm-table">
            <thead><tr><th>Canonical</th><th>Aliases</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
          <div class="group mt8">
            <input id="norm-canonical" type="text" placeholder="e.g. spring onion" />
            <input id="norm-aliases" type="text" placeholder="aliases (comma-separated)" />
            <button class="btn" id="norm-add">Add</button>
          </div>
        </section>

        <section>
          <h4 class="h4">Unit defaults</h4>
          <table class="table" id="unit-table">
            <thead><tr><th>Ingredient</th><th>Type</th><th>Unit label</th><th>Locked</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
          <div class="group mt8">
            <input id="unit-name" type="text" placeholder="e.g. chicken breast" />
            <select id="unit-type">
              <option value="grams">grams</option>
              <option value="ml">ml</option>
              <option value="tsp">tsp</option>
              <option value="tbsp">tbsp</option>
              <option value="cup">cup</option>
              <option value="qty">quantity</option>
            </select>
            <input id="unit-label" type="text" placeholder="unit label (for qty)" />
            <label class="muted"><input id="unit-locked" type="checkbox" /> locked</label>
            <button class="btn" id="unit-add">Add/Update</button>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Mobile Filters Modal -->
  <div id="filters-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="dialog">
      <div class="toolbar stickybar">
        <h3 class="h3">Filters</h3>
        <button class="btn" id="filters-close">Close</button>
      </div>

      <div class="form-row">
        <label>Time to cook</label>
        <div class="range wide">
          <input id="m-time-min" type="range" min="0" max="120" step="5" value="0" style="flex:1" />
          <span class="muted" id="m-time-label">0‚Äì120 min</span>
          <input id="m-time-max" type="range" min="0" max="120" step="5" value="120" style="flex:1" />
        </div>

        <div class="group mt8">
          <button class="btn" id="m-time-clear" type="button">Clear time</button>
          <button class="btn" id="m-favs" type="button">Show favourites only</button>
        </div>
      </div>

      <div class="form-row">
        <label>Tag filter</label>
        <div class="group">
          <button class="btn primary big-action" id="m-tag-filter" type="button">Choose tags</button>
          <span class="muted" id="m-tag-active"></span>
        </div>
      </div>

      <div class="form-row">
        <label>Grid density</label>
        <div class="group">
          <button class="btn" data-density="compact" type="button">Compact</button>
          <button class="btn" data-density="cozy" type="button">Cozy</button>
          <button class="btn" data-density="comfy" type="button">Comfy</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom nav (mobile only; switches views) -->
  <nav id="bottom-nav" class="bottom-nav" aria-label="Bottom navigation">
    <button class="navbtn" data-view="meals">üçΩÔ∏è Meals</button>
    <button class="navbtn" data-view="shopping">üõí Shopping</button>
    <button class="navbtn" data-view="add">‚ûï Add</button>
    <button class="navbtn" data-view="cook">üî• Cook</button>
  </nav>
</body>
</html>
