:root{
  --bg:#0b0f1a; --panel:#101826; --card:#0b1220;
  --text:#e5e7eb; --muted:#94a3b8; --chip:#1f2937;
  --danger:#ef4444; --accent:#22c55e; --gold:#facc15;
  --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
  --card-min:260px;
}
[data-theme="light"]{
  --bg:#f6f7fb; --panel:#fff; --card:#fff;
  --text:#111827; --muted:#64748b; --chip:#e5e7eb;
  --danger:#ef4444; --accent:#16a34a; --gold:#facc15;
  --shadow:0 10px 30px rgba(0,0,0,.08);
}

/* ===== Base ===== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  background: radial-gradient(1000px 500px at 20% -10%, rgba(34,197,94,.18), transparent 60%),
              radial-gradient(900px 400px at 90% 0%, rgba(250,204,21,.12), transparent 60%),
              var(--bg);
  color:var(--text);
}

a{color:inherit}
.hidden{display:none !important}
.muted{color:var(--muted)}
small.muted{font-size:.82rem}

/* ===== Layout ===== */
.wrap{max-width:1100px;margin:0 auto;padding:18px 14px 90px}
header{
  display:flex; align-items:flex-start; justify-content:space-between;
  gap:14px; padding:12px 10px;
}
.brand{
  display:flex; flex-direction:column; gap:6px;
}
.brand h1{margin:0;font-size:1.9rem;letter-spacing:.2px}
.version{
  display:inline-flex; align-items:center; gap:8px;
}
.pill{
  display:inline-flex; align-items:center; gap:8px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  padding:6px 10px; border-radius:999px;
  color:var(--muted); font-size:.85rem;
}
.pill .dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--accent);
  box-shadow:0 0 0 3px rgba(34,197,94,.25);
}
.actions-top{
  display:flex; align-items:center; gap:10px; justify-content:flex-end;
}
.icon-btn{
  width:48px;height:48px;border-radius:14px;
  display:grid;place-items:center;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  box-shadow: var(--shadow);
  cursor:pointer;
}
.icon-btn:active{transform:translateY(1px)}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:10px 14px; border-radius:14px;
  background:rgba(255,255,255,.06);
  color:var(--text);
  border:1px solid rgba(255,255,255,.10);
  cursor:pointer;
  transition:transform .05s ease, background .15s ease, border-color .15s ease;
}
.btn:hover{background:rgba(255,255,255,.09)}
.btn:active{transform:translateY(1px)}
.btn.primary{
  background:rgba(34,197,94,.18);
  border-color:rgba(34,197,94,.35);
}
.btn.danger{
  background:rgba(239,68,68,.20);
  border-color:rgba(239,68,68,.35);
}
.btn.ghost{background:transparent}
.btn.small{padding:7px 10px;border-radius:12px;font-size:.88rem}

.panel{
  background: rgba(16,24,38,.72);
  border:1px solid rgba(255,255,255,.08);
  box-shadow: var(--shadow);
  border-radius: var(--radius);
  padding:14px;
  backdrop-filter: blur(10px);
}

.section-top{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  margin-top:10px;
}
.section-top h2{margin:0;font-size:2.1rem;letter-spacing:.1px}
.section-top .right{
  display:flex; align-items:center; justify-content:flex-end; gap:10px;
}

.search{
  width:min(360px, 45vw);
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  border-radius:16px;
  padding:10px 12px;
  color:var(--text);
  outline:none;
}
.search::placeholder{color:rgba(148,163,184,.7)}

.tag-row{
  display:flex; gap:10px;
  overflow:auto; padding:10px 0 6px;
  scrollbar-width:none;
}
.tag-row::-webkit-scrollbar{display:none}
.tag{
  flex:0 0 auto;
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px; border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  color:var(--muted);
  cursor:pointer;
  user-select:none;
}
.tag strong{color:var(--text);font-weight:600}
.tag.active{
  background:rgba(34,197,94,.16);
  border-color:rgba(34,197,94,.32);
  color:var(--text);
}

.grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--card-min), 1fr));
  gap:14px;
  margin-top:10px;
}

/* ===== Cards ===== */
.card{
  background: rgba(11,18,32,.88);
  border:1px solid rgba(255,255,255,.08);
  border-radius: 20px;
  box-shadow: var(--shadow);
  overflow:hidden;
}
.media{
  position:relative;
  height:150px;
  background:rgba(255,255,255,.06);
}
.media img{
  width:100%; height:100%;
  object-fit:cover;
  display:block;
}
.select{
  position:absolute;
  top:10px; left:10px;
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px;
  background:rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.18);
  border-radius:999px;
  font-size:.9rem;
  color:#fff;
  backdrop-filter: blur(6px);
}
.select input{width:16px;height:16px}
.body{
  padding:12px 12px 14px;
}
.card h3{
  margin:0 0 8px;
  font-size:1.1rem;
}
.meta{
  display:flex; gap:8px; flex-wrap:wrap;
  margin-bottom:10px;
}
.chip{
  display:inline-flex; align-items:center; gap:6px;
  padding:5px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  color:var(--muted);
  font-size:.85rem;
}
.controls{
  display:flex; gap:8px;
}
.controls .btn{flex:1 1 auto}

/* ===== Bottom Nav ===== */
#bottom-nav{
  position:fixed;
  left:0; right:0; bottom:0;
  z-index:9999;
  padding:10px 12px;
  backdrop-filter: blur(12px);
  background: rgba(11,18,32,.65);
  border-top:1px solid rgba(255,255,255,.08);
}
#bottom-nav .row{
  max-width:1100px; margin:0 auto;
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}
.nav-btn{
  display:flex; align-items:center; justify-content:center; gap:10px;
  border-radius:16px;
  padding:12px 10px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  color:var(--text);
  cursor:pointer;
}
.nav-btn.active{
  background:rgba(34,197,94,.16);
  border-color:rgba(34,197,94,.32);
}
.nav-btn .ico{font-size:1.2rem}

/* ===== Modals / Forms ===== */
dialog{
  width:min(740px, 94vw);
  border:none;
  border-radius: 22px;
  padding:0;
  overflow:hidden;
  background: rgba(16,24,38,.92);
  color:var(--text);
  box-shadow: var(--shadow);
}
dialog::backdrop{
  background: rgba(0,0,0,.6);
  backdrop-filter: blur(4px);
}
.modal-head{
  padding:14px 16px;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.modal-head h3{margin:0;font-size:1.2rem}
.modal-body{padding:14px 16px}
.form-row{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
}
label{display:block;font-size:.9rem;color:var(--muted);margin-bottom:6px}
input[type="text"], input[type="number"], textarea, select{
  width:100%;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:10px 12px;
  color:var(--text);
  outline:none;
}
textarea{min-height:110px;resize:vertical}
.hr{height:1px;background:rgba(255,255,255,.08);margin:12px 0}
.modal-actions{
  padding:12px 16px;
  display:flex; gap:10px; justify-content:flex-end;
  border-top:1px solid rgba(255,255,255,.08);
}

@media (max-width:860px){
  .wrap{padding-bottom:100px}
  .section-top{flex-direction:column; align-items:flex-start}
  .section-top .right{width:100%}
  .search{width:100%}
  .form-row{grid-template-columns:1fr}
}

/* Keep the nav above Android gesture bar / iOS home indicator */
@supports (padding-bottom: env(safe-area-inset-bottom)){
  #bottom-nav{padding-bottom: calc(10px + env(safe-area-inset-bottom))}
}

@media (max-width:720px){
  #bottom-nav{
    position: fixed !important;
    left: 0; right: 0; bottom: 0;
    z-index: 9999 !important;
  }
}

/* ============================================================
   v9.4 MOBILE LIST "FORCE" OVERRIDES
   - These are intentionally strong so the layout *must* change.
   - Only applies on phones.
   ============================================================ */
@media (max-width:720px){

  /* Force compact list-row cards */
  .grid .card,
  .card{
    display:flex !important;
    flex-direction:row !important;
    align-items:stretch !important;
    width:100% !important;
    max-width:100% !important;
    overflow:hidden !important;
  }

  /* Smaller thumbnail */
  .card .media{
    flex:0 0 72px !important;
    width:72px !important;
    min-width:72px !important;
    height:72px !important;
  }
  .card img{
    height:72px !important;
    width:100% !important;
    object-fit:cover !important;
    border-radius:12px 0 0 12px !important;
  }

  /* Make right side a tight vertical stack */
  .card > :nth-child(2){
    flex:1 1 auto !important;
    min-width:0 !important;
    width:auto !important;
    padding:8px 10px !important;
    display:flex !important;
    flex-direction:column !important;
    gap:6px !important;
  }

  /* Title: 2-line clamp */
  .card h3{
    margin:0 !important;
    font-size:.95rem !important;
    line-height:1.2 !important;
    overflow:hidden !important;
    display:-webkit-box !important;
    -webkit-line-clamp:2 !important;
    -webkit-box-orient:vertical !important;
    word-break:break-word !important;
    overflow-wrap:anywhere !important;
  }

  /* Smaller chips / time */
  .card .chip{
    font-size:.72rem !important;
    padding:3px 8px !important;
  }

  /* Buttons: fit within card without spilling off-screen
     - Prefer natural (content) width
     - Allow wrap onto a new line when space is tight
     - Keep Delete readable, avoid Edit stretching to full-width unnecessarily
  */
  .controls{
    margin:4px 0 0 !important;
    display:flex !important;
    flex-wrap:wrap !important;            /* ✅ allow wrap when needed */
    gap:6px !important;
    max-width:100% !important;
    min-width:0 !important;
    align-items:stretch !important;
  }
  .controls .btn{
    flex:0 1 auto !important;             /* ✅ size to content, but can shrink */
    min-width:0 !important;
    max-width:100% !important;
    padding:8px 10px !important;
    font-size:.85rem !important;
    border-radius:10px !important;
    white-space:normal !important;        /* ✅ allow multi-line if text would overflow */
    overflow-wrap:anywhere !important;
    line-height:1.15 !important;
  }
  /* Let the non-danger button use remaining space, but cap it so it doesn't look huge */
  .controls .btn:not(.danger){
    flex:1 1 120px !important;
    max-width:240px !important;           /* prevents "Edit" becoming massive on wide phones */
  }
  /* Delete stays content-sized but can wrap if needed */
  .controls .btn.danger{
    flex:0 1 auto !important;
  }

  /* Selection pill: stop it eating the image */
  .select{
    top:6px !important;
    left:6px !important;
    padding:4px 6px !important;
    font-size:.75rem !important;
    gap:4px !important;
    max-width:44px !important;          /* hides "Include" without needing spans */
    overflow:hidden !important;
  }
}
